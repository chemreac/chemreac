language: c
env:
  matrix:
    - PYTHON_VERSION=2.7 CONDA_PY=27 BUILD_DOCS=1
    - PYTHON_VERSION=3.4 CONDA_PY=34 BUILD_DOCS=0
  global:
    - BINSTAR_USER=chemreac
    - GITHUB_USER=chemreac
    - GITHUB_REPO=chemreac
    - CONDA_VERSION="3.7.3"
    - ENV_NAME=testenv
    - secure: "BT/3IhbCg5ctQ4Y8cvbb9FdgoGHcbmXFhRasBY2jwm5y6FtWlLeh0CB5dSN9b/Dei2C6g/v7InY1zc6/fjdDFEAMglPJb7Py5xRq20/UE86e1YtZKym/E4ULKl7UDlwlmOjpzm7uYdPHGjSqRb4W699snKwFP1es5TpGaauhBCU="
    - secure: "bz1+ymp/bgF2FRiE7DzOGTuWWZ5TuXR+/LLBFiEfxE3aiXeyM6H3pLgVCBeiejW9lXdDJaSd7peMIX3qUAumHWwhXG/yPhI0eSp2PXhGCjh3Ed+RQskAFmhahg7UGfKe0O7MvAdnsNlF4xOc+lp3n4z6NZoIpLsfznDkjl0KVWg="
before_install:
  - export CONDA_PATH=$HOME/miniconda
  - source ./scripts/install_miniconda.sh $PYTHON_VERSION $CONDA_PATH $CONDA_VERSION
  - conda config --add channels http://conda.binstar.org/$BINSTAR_USER
  - conda config --add channels http://conda.binstar.org/bjodah  # migrate this later
  - ./scripts/ubuntu12.04/apt_get_gcc_48.sh
  - ./scripts/ubuntu12.04/apt_get_g++_48.sh
  - ./scripts/ubuntu12.04/apt_get_gfortran_48.sh
  - ./scripts/aptget_debian.sh
  - ./scripts/install_sundials_w_lapack.sh
  - export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH
  - mkdir -p $HOME/.config/matplotlib/
  - cp ./scripts/matplotlibrc $HOME/.config/matplotlib/
install:
  - if [[ "$TRAVIS_BRANCH" =~ ^v[0-9]+.[0-9]?* ]]; then export CHEMREAC_RELEASE_VERSION=$TRAVIS_BRANCH; fi
  - source ./scripts/ci_conda.sh $PYTHON_VERSION $CONDA_PY $ENV_NAME 0
script:
  - LIBRARY_PATH=$CONDA_PATH/envs/$ENV_NAME/lib:$LIBRARY_PATH ./scripts/run_tests.sh
after_success:
  - coveralls
  - ./scripts/travis_after_success.sh $CONDA_PATH
notifications:
  email: false
